<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="853px" preserveAspectRatio="none" style="width:898px;height:853px;" version="1.1" viewBox="0 0 898 853" width="898px" zoomAndPan="magnify"><defs><filter height="300%" id="fppd7jcswr1b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster State Machine Replication--><rect fill="#FFFFFF" filter="url(#fppd7jcswr1b)" height="818" style="stroke: #000000; stroke-width: 1.5;" width="793" x="22" y="24"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="327" y="42.8643">State Machine Replication</text><!--cluster Server1--><rect fill="#ADD8E6" filter="url(#fppd7jcswr1b)" height="286" style="stroke: #000000; stroke-width: 1.5;" width="234" x="46" y="70"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="135" y="88.8643">Server1</text><!--cluster Server2--><rect fill="#F08080" filter="url(#fppd7jcswr1b)" height="398" style="stroke: #000000; stroke-width: 1.5;" width="206" x="559" y="420"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="634" y="438.8643">Server2</text><!--entity ServerN1--><rect fill="#FFFF00" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #000000; stroke-width: 1.5;" width="87" x="363.5" y="458"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="373.5" y="484.8643">ServerN+1</text><!--entity TwoHardThins--><rect fill="#90EE90" filter="url(#fppd7jcswr1b)" height="119.7021" style="stroke: none; stroke-width: 1.5;" width="285" x="498.5" y="231"/><path d="M483.5,231 L498.5,231 L498.5,350.7021 L783.5,350.7021 L783.5,231 L798.5,231 " fill="none" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="265" x="508.5" y="257.8643">Two hard problems in distributed systems:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="149" x="508.5" y="277.8047">2. Exactly-once delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="214" x="508.5" y="297.7451">1. Guaranteed order of messages</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="149" x="508.5" y="317.6855">2. Exactly-once delivery</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="508.5" y="337.626">@mathiasverraes</text><!--entity SM1--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="97.8213" style="stroke: #000000; stroke-width: 1.5;" width="173" x="62.5" y="242"/><path d="M120.1667,243 L120.1667,247 L113.1667,254 L62.5,254 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="77.5" y="278.8643">State Machine</text><line style="stroke: #000000; stroke-width: 1.0;" x1="63.5" x2="234.5" y1="281.9404" y2="281.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="83.5" y="302.8047">balance(alice)=199</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="83.5" y="322.7451">balance(bob)=1</text><!--entity Consensus1--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="172.5" y="108"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="167.5" y="113"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="167.5" y="137.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="182.5" y="134.8643">Consensus</text><!--entity Ledger1--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="62.5" y="108"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="57.5" y="113"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="57.5" y="137.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="72.5" y="134.8643">Ledger</text><!--entity SM2--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="97.8213" style="stroke: #000000; stroke-width: 1.5;" width="173" x="575.5" y="704"/><path d="M633.1667,705 L633.1667,709 L626.1667,716 L575.5,716 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="590.5" y="740.8643">State Machine</text><line style="stroke: #000000; stroke-width: 1.0;" x1="576.5" x2="747.5" y1="743.9404" y2="743.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="596.5" y="764.8047">balance(alice)=199</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="596.5" y="784.7451">balance(bob)=1</text><!--entity Consensus2--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #A80036; stroke-width: 1.5;" width="91" x="595.5" y="458"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="590.5" y="463"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="590.5" y="487.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="605.5" y="484.8643">Consensus</text><!--entity Ledger2--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #A80036; stroke-width: 1.5;" width="65" x="621.5" y="581"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="616.5" y="586"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="616.5" y="610.9404"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="631.5" y="607.8643">Ledger</text><!--entity Client--><rect fill="#FEFECE" filter="url(#fppd7jcswr1b)" height="39.9404" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="831" y="733"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="841" y="759.8643">Client</text><!--link Client to Consensus1--><path d="M858.152,732.587 C856.978,704 855,648.892 855,602 C855,290 855,290 855,290 C855,237.143 856.924,210.191 815,178 C772.144,145.093 405.411,133.321 268.91,130.057 " fill="none" id="Client-&gt;Consensus1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="263.759,129.935,272.6628,134.1448,268.7576,130.0521,272.8502,126.147,263.759,129.935" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="856" y="485.5688">1</text><!--link Consensus1 to TwoHardThins--><path d="M268.421,148.191 C320.776,168.118 405.415,200.333 480.8,229.026 " fill="none" id="Consensus1-TwoHardThins" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="485.752,230.91,478.7636,223.9701,481.079,229.1314,475.9178,231.4469,485.752,230.91" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="263.67,146.383,270.6584,153.3229,268.343,148.1616,273.5042,145.8461,263.67,146.383" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="405" y="197.0688">2</text><!--link TwoHardThins to Consensus2--><path d="M641,356.27 C641,389.501 641,428.11 641,452.544 " fill="none" id="TwoHardThins-Consensus2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="641,457.836,645,448.836,641,452.836,637,448.836,641,457.836" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="641,351.044,637,360.044,641,356.044,645,360.044,641,351.044" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="642" y="400.0688">2</text><!--link Consensus1 to ServerN1--><path d="M226.907,153.046 C243.428,196.521 281.073,290.503 324,364 C343.185,396.847 369.877,431.7 387.761,453.87 " fill="none" id="Consensus1-ServerN1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="390.994,457.858,388.4341,448.3477,387.8455,453.9738,382.2193,453.3852,390.994,457.858" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="225.092,148.249,224.5347,158.0821,226.8609,152.9256,232.0174,155.2518,225.092,148.249" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="325" y="298.5688">2 問題：故障與時序</text><!--link Consensus2 to ServerN1--><path d="M590.208,478 C550.37,478 495.266,478 455.917,478 " fill="none" id="Consensus2-ServerN1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="450.739,478,459.739,482,455.739,478,459.739,474,450.739,478" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="595.479,478,586.479,474,590.479,478,586.479,482,595.479,478" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="519" y="471.0688">2</text><!--link Consensus1 to Ledger1--><path d="M172.243,128 C159.279,128 145.314,128 132.871,128 " fill="none" id="Consensus1-&gt;Ledger1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="127.639,128,136.639,132,132.639,128,136.639,124,127.639,128" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="146" y="121.0688">3</text><!--link Ledger1 to SM1--><path d="M101.4066,148.101 C108.699,169.844 120.927,206.3 131.162,236.816 " fill="none" id="Ledger1-&gt;SM1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="132.786,241.659,133.7161,231.8542,131.1959,236.9186,126.1314,234.3984,132.786,241.659" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="120" y="197.0688">4</text><!--link Consensus2 to Ledger2--><path d="M643.06,498.173 C645.323,519.237 648.962,553.103 651.415,575.936 " fill="none" id="Consensus2-&gt;Ledger2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="651.95,580.917,654.9681,571.542,651.4171,575.9455,647.0136,572.3946,651.95,580.917" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="649" y="547.0688">3</text><!--link Ledger2 to SM2--><path d="M655.029,621.303 C656.066,640.738 657.712,671.605 659.145,698.463 " fill="none" id="Ledger2-&gt;SM2" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="659.428,703.776,662.9414,694.5751,659.1609,698.7831,654.9529,695.0026,659.428,703.776" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="658" y="670.0688">4</text><!--link SM2 to Client--><path d="M748.694,753 C775.91,753 804.347,753 825.53,753 " fill="none" id="SM2-&gt;Client" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="830.754,753,821.754,749,825.754,753,821.754,757,830.754,753" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="8" x="785.75" y="746.0688">5</text><!--
@startuml

agent "Client" as Client

rectangle "State Machine Replication" {

    rectangle "Server1" #LightBlue {
        frame SM1 [
            State Machine 
            - - - -
            balance(alice)=199
            balance(bob)=1
        ] 
        component "Consensus" as Consensus1
        component "Ledger" as Ledger1
    }

    rectangle "Server2" #LightCoral{
        frame SM2 [
            State Machine 
            - - - -
            balance(alice)=199
            balance(bob)=1
        ]

        component "Consensus" as Consensus2
        component "Ledger" as Ledger2
    }

    rectangle "ServerN+1" as ServerN1 #yellow

    stack TwoHardThins #LightGreen[
        Two hard problems in distributed systems:
        2. Exactly-once delivery 
        1. Guaranteed order of messages 
        2. Exactly-once delivery
        @mathiasverraes
    ]
}

Client - -> Consensus1 : == 1
Consensus1 <- -> TwoHardThins : == 2
TwoHardThins <- -> Consensus2 : == 2
Consensus1 <- -> ServerN1: == 2 問題：故障與時序
Consensus2 <-> ServerN1 : == 2
Consensus1 -> Ledger1 : == 3
Ledger1 - -> SM1 : == 4
Consensus2 - -> Ledger2: == 3
Ledger2 - -> SM2 : == 4
SM2 -> Client: == 5
@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 CST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_221-b11
Operating System: Windows 10
OS Version: 10.0
Default Encoding: MS950
Language: zh
Country: TW
--></g></svg>